<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>元旦快乐！-ZZ91再生网</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
<link href="http://img0.zz91.com/front/favicon.ico" rel="shortcut icon">
<link rel="stylesheet" href="../subject/newyear/css/swiper.min.css">
<link rel="stylesheet" href="../subject/newyear/css/animate.min.css">
<link rel="stylesheet" href="../subject/newyear/css/newcss.css">
<link rel="stylesheet" href="../subject/newyear/css/index.css">
<script src="../subject/newyear/js/swiper.min.js"></script>
<script src="../subject/newyear/js/swiper.animate.min.js"></script>
<script src="http://img0.zz91.com/lib/jquery/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="http://m.zz91.com/zhongqiu/js/layer/layer.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<meta name="viewport" id="viewport" content="width=320, initial-scale=1, maximum-scale=1, user-scalable=no">

<style>
	#mcover{ position: fixed;top:0;left:0;width:100%;	height:100%;background:rgba(0, 0, 0, 0.7);	display:none;z-index:20000;}
	#mcover img {position: fixed;right: 18px;top:5px;width: 260px;height: 180px;z-index:20001;}
</style>
</head>
<body>
	<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
	<img src="http://m.zz91.com/subject/newyear/images/img9.png">
	</div>
	<div id="mcover" onclick="$('#mcover').hide();">
		<img src="http://img0.zz91.com/zz91/mobile/images/guide.png" />
	</div>
<div class="swiper-container">
    <div class="swiper-wrapper">
        <section class="swiper-slide swiper-slide1">
            <!-- <div class="bgdiv"></div> -->
            <div class="slide-main">

                <img src="../subject/newyear/images/bgimg.png" class="ani resize bgdiv" style="width:304px;height:480px;margin-left:-152px;margin-top:-240px;left:50%;top:50%;z-index:3; " swiper-animate-effect="ruand_end"><!-- swiper-animate-duration="11s" swiper-animate-delay="0.7s" -->


                 <img src="../subject/newyear/images/img1.png" class="ani resize" style="width:30%;height:16%;left:54%;top:11%;z-index:3; " swiper-animate-effect="img_play1">

                 <img src="../subject/newyear/images/img2.png" class="ani resize" style="width:53%;height:52%;left:26%;top:13%;z-index:3; " swiper-animate-effect="img_play2">

                 <img src="../subject/newyear/images/img1.png" class="ani resize" style="width:30%;height:16%;left:21%;top:49%;z-index:3; " swiper-animate-effect="img_play1">

                 <img src="../subject/newyear/images/img3.png" class="ani resize" style="width:100%;height:37%;left:0%;top:60%;z-index:3; " swiper-animate-effect="img_play3">
            </div>
        </section>

        <section class="swiper-slide swiper-slide2">
            <!-- <div class="bgdiv"></div> -->
            <div class="slide-main">

                <img src="../subject/newyear/images/bgimg.png" class="ani resize bgdiv" style="width:304px;height:480px;margin-left:-152px;margin-top:-240px;left:50%;top:50%;z-index:3; " swiper-animate-effect="ruand_end"><!-- swiper-animate-duration="11s" swiper-animate-delay="0.7s" -->


                 <img src="../subject/newyear/images/img4.png" class="ani resize" style="width:32%;height:29%;left:0.625%;top:-0.3%;z-index:3; " swiper-animate-effect="img_play4">

                 <img src="../subject/newyear/images/img5.png" class="ani resize" style="width:32%;height:24%;left:34%;top:-0.3%;z-index:3; " swiper-animate-effect="img_play5">

                 <img src="../subject/newyear/images/img6.png" class="ani resize" style="width:32%;height:25%;left:67%;top:-0.3%;z-index:3; " swiper-animate-effect="img_play6">

                 <div class="ani resize" style="width:79%;height:auto;left:9%;top:28%;z-index:3; " swiper-animate-effect="text-wen1">不知不觉到元旦，匆匆而过又一年; 云卷云舒情如水，月落日出为赚钱；祝您：日子如蜜甜;汗水浇开财运花， 大步流星总向前</div>

                 <img src="../subject/newyear/images/img7.png" class="ani resize" style="width:91%;height:46%;left:7%;top:53%;z-index:3; " swiper-animate-effect="img_play7">
            </div>
        </section>


        <section class="swiper-slide swiper-slide3">
            <!-- <div class="bgdiv"></div> -->
            <div class="slide-main">

                <img src="../subject/newyear/images/bgimg.png" class="ani resize bgdiv" style="width:304px;height:480px;margin-left:-152px;margin-top:-240px;left:50%;top:50%;z-index:2; " swiper-animate-effect="ruand_end"><!-- swiper-animate-duration="11s" swiper-animate-delay="0.7s" -->


                 <img src="../subject/newyear/images/img8.png" class="ani resize" style="width:85%;height:39%;left:9%;top:0%;z-index:3; " swiper-animate-effect="img_play8">

                 <!-- <img src="../subject/newyear/images/img9.png" class="ani resize" style="width:30%;height:20%;left:5%;top:41%;z-index:3; "> -->

                 <button  class="ani resize startrecord"  style="width:69%;height:8%;left:16%;top:52%;z-index:3;" swiper-animate-effect="btn1">点此留下语音祝福</button>

                 <button  class="ani resize playrecord"  style="width:69%;height:8%;left:16%;top:43%;z-index:3;display: none;" swiper-animate-effect="btn2">点此听好友的祝福</button>

                 <img src="../subject/newyear/images/img9.png" class="ani resize" style="width:55%;height:42%;left:24%;top:58%;z-index:2; " swiper-animate-effect="img_play9">
            </div>
        </section>

        <section class="swiper-slide swiper-slide4">
            <!-- <div class="bgdiv"></div> -->
            <div class="slide-main">

                <img src="../subject/newyear/images/bgimg.png" class="ani resize bgdiv" style="width:304px;height:480px;margin-left:-152px;margin-top:-240px;left:50%;top:50%;z-index:2; " swiper-animate-effect="ruand_end"><!-- swiper-animate-duration="11s" swiper-animate-delay="0.7s" -->


                 <img src="../subject/newyear/images/img8.png" class="ani resize" style="width:85%;height:39%;left:9%;top:0%;z-index:3; " swiper-animate-effect="img_play8">
                 <img src="../subject/newyear/images/img3.png" class="ani resize" style="width:100%;height:37%;left:0%;top:60%;z-index:3; " swiper-animate-effect="img_play3">

                 <img src="../subject/newyear/images/img12.png" class="ani resize" style="width:45%;left:4%;top:47%;z-index:3; opacity: 0.56" >

                 <img src="../subject/newyear/images/img13.png" class="ani resize" style="width:41%;left:50%;top:47.5%;z-index:3; opacity: 0.56" >
            </div>
        </section>
    </div>


    <img src="../subject/newyear/images/web-swipe-tip_95ef4d6.png" style="width:24px;height:18px; bottom:10px; left:50%;margin-left: -12px;" id="array" class="resize">


    <div class="swiper-pagination"></div>
    <div class="music-box music-play">
        <audio id="music-audio" class="audio" preload="" autoplay="autoplay" loop="">
            <source src="../subject/newyear/newyear.mp3"></source>
        </audio>
        <div class="music"></div>  
    </div>
</div>
<script>
	var oindex = 0;
	var nicheng = "";
	var serverId="";
	var recordflag=0;
	var localId="";
	function sharefunction() {
		wx.onMenuShareAppMessage({
			title: '元旦快乐！-ZZ91再生网',
			desc: '不知不觉到元旦，匆匆而过又一年; 云卷云舒情如水，月落日出为赚钱；祝您：日子如蜜甜;汗水浇开财运花， 大步流星总向前',
			link: 'http://m.zz91.com/newyear/index.html?s={{signature}}',
			imgUrl: 'http://m.zz91.com/subject/newyear/images/img3.png',
			trigger: function(res) {
				
			},
			success: function(res) {
				layer.msg("分享成功。");
				$('#mcover').hide();
			},
			cancel: function(res) {
				//alert('已取消');
			},
			fail: function(res) {
				//alert(JSON.stringify(res));
			}
		});
		wx.onMenuShareTimeline({
			title: '元旦快乐！-ZZ91再生网',
			desc: '不知不觉到元旦，匆匆而过又一年; 云卷云舒情如水，月落日出为赚钱；祝您：日子如蜜甜;汗水浇开财运花， 大步流星总向前',
			link: 'http://m.zz91.com/newyear/index.html?s={{signature}}',
			imgUrl: 'http://m.zz91.com/subject/newyear/images/img3.png',
			trigger: function(res) {
				//$('#mcover').show();
			},
			success: function(res) {
				layer.msg("分享成功。");
				$('#mcover').hide();
			},
			cancel: function(res) {
				//alert('已取消');
			},
			fail: function(res) {
				//alert(JSON.stringify(res));
			}
		});
	}
	var serverrecord="{{content}}";
	//alert(serverrecord)
	if (serverrecord=="None" || serverrecord==""){
		$(".playrecord").css("display","none");
	}else{
		$(".playrecord").css("display","block");
	}
	$(function(){
        wx.config({
			debug: false,
			appId: '{{appid}}',
			timestamp: {{timestamp}},
			nonceStr: '{{nonceStr}}',
			signature: '{{signature}}',
			jsApiList: [
				'checkJsApi',
				'onMenuShareTimeline',
				'onMenuShareAppMessage',
				'startRecord',
				'stopRecord',
				'onVoiceRecordEnd',
				'playVoice',
				'uploadVoice',
				'downloadVoice',
			]
		});
		sharefunction();
		
		function sharetofriend(){
			layer.msg('立即分享给您的亲人或朋友吧。', {
			  time: 0 //不自动关闭
			  ,btn: ['立即分享','取消']
			  ,yes: function(index){
			    layer.close(index);
			    $('#mcover').show();
				sharefunction();
			  }
			});
		}
		function savedata(content){
			var data={
				signature : '{{signature}}',
				content : content,
				sharename : 'ZZ91再生网',
			}
			
			sharefunction()
			$.ajax({
				url : 'http://m.zz91.com/zhongqiu/savecontent.html',
				type : 'post',
				dataType : 'json',
				cache : false,
				data : data,
			    success:function(ret) {
					if (ret) {
						//alert(ret)
					} else {
						//alert('异常！1')
					};
				},
				error : function(e) {
					//alert(alert(JSON.stringify(e)));
				}
			});
		}
		wx.ready(function(){
			
			
			$(".startrecord").on("click",function(){
				document.getElementById('music-audio').pause();
				if (recordflag==0){
					wx.startRecord();
					recordflag=1;
					$(".startrecord").html("正在录音...点击停止");
					wx.onVoiceRecordEnd({
					    // 录音时间超过一分钟没有停止的时候会执行 complete 回调
					    complete: function (res) {
					        localId = res.localId;
					        recordflag=0;
					        $(".startrecord").html("点击重新录音");
					        $(".playrecord").show();
					        $(".playrecord").css("display","block");
					        $(".playrecord").html("听听我的录音!");
					        wx.uploadVoice({
							    localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
							    isShowProgressTips: 1, // 默认为1，显示进度提示
						        success: function (res) {
							        serverId = res.serverId; // 返回音频的服务器端ID
							        savedata(serverId);
							        sharetofriend();
							    }
							});
					        
					    }
					});
				}else{
					wx.stopRecord({
					    success: function (res) {
					        localId = res.localId;
					        recordflag=0;
					        $(".startrecord").html("点击重新录音");
					        $(".playrecord").show();
					        $(".playrecord").css("display","block");
					        $(".playrecord").html("听听我的录音!");
					        wx.uploadVoice({
							    localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
							    isShowProgressTips: 1, // 默认为1，显示进度提示
						        success: function (res) {
							        serverId = res.serverId; // 返回音频的服务器端ID
							        savedata(serverId);
							        sharetofriend();
							    }
							});
					    }
					});
					recordflag=0
				}
		    })
			$(".playrecord").on("click",function(){
				var self=$(this);
				if (localId==""){
					//alert('没有录音文件!');
					wx.downloadVoice({
					    serverId: '{{content}}', // 需要下载的音频的服务器端ID，由uploadVoice接口获得
					    isShowProgressTips: 1, // 默认为1，显示进度提示
					    success: function (res) {
					        localId = res.localId; // 返回音频的本地ID
					        //alert(localId)
					        wx.playVoice({
							    localId: localId // 需要播放的音频的本地ID，由stopRecord接口获得
							});
							$(".playrecord").html("正在播放录音...")
					    }
					});
				}else{
					wx.playVoice({
					    localId: localId // 需要播放的音频的本地ID，由stopRecord接口获得
					});
					$(".playrecord").html("正在播放录音...")
				}
				wx.onVoicePlayEnd({
				    success: function (res) {
				        localId = res.localId; // 返回音频的本地ID
				        $(".playrecord").html("点此重听");
				    }
				});
		    })
			$(".fenxian").on("click", function() {
				if(ua.match(/MicroMessenger/i)=="micromessenger") {
					$('#mcover').show();
					sharefunction();
				}
			});
			sharefunction();
	    })
		
	})

    $(".music-box").on("click",function(){
        if($(this).hasClass('rotate')){
             document.getElementById('music-audio').pause();
        }else{
            document.getElementById('music-audio').play();
        }
        $(this).toggleClass("rotate");
    })
    var pageScale = 1;

    var width = document.documentElement.clientWidth || 320;
    var height = document.documentElement.clientHeight || 480;
    if (width / height >= 320 / 480) {
        pageScale = height / 480;
    } else {
        $(".bgdiv").width(320).css({"left":0,marginLeft:0});
        pageScale = width / 320;
    }
    var content = 'width=320, initial-scale=' + pageScale + ', maximum-scale=' + pageScale + ', user-scalable=no';
    document.getElementById('viewport').setAttribute('content', content); 

	document.getElementById('music-audio').play();
	$(".music-box").toggleClass("rotate");
	
    scaleW=window.innerWidth/320;
    scaleH=window.innerHeight/480;
    var resizes = document.querySelectorAll('.resize');
        for (var j=0; j<resizes.length; j++) {
        }
          
    var mySwiper = new Swiper ('.swiper-container', 
                                {   
                                    initialSlide:0,
                                    direction : 'vertical',
                                    pagination: '.swiper-pagination',
                                    //virtualTranslate : true,
                                    mousewheelControl : true,
                                    onInit: function(swiper){
                                    swiperAnimateCache(swiper);
                                    swiperAnimate(swiper);
                                },
                                onSlideChangeEnd: function(swiper){
                                    swiperAnimate(swiper);
                                },
                                onTransitionEnd: function(swiper){
                                    swiperAnimate(swiper);
                                },
                                watchSlidesProgress: true,
                                onProgress: function(swiper){
                                    for (var i = 0; i < swiper.slides.length; i++){
                                        var slide = swiper.slides[i];
                                        var progress = slide.progress;
                                        var translate = progress*swiper.height/4;  
                                        scale = 1 - Math.min(Math.abs(progress * 0.5), 1);
                                        var opacity = 1 - Math.min(Math.abs(progress/2),0.5);
                                        slide.style.opacity = opacity;
                                        es = slide.style;
                                        es.webkitTransform = es.MsTransform = es.msTransform = es.MozTransform = es.OTransform = es.transform = 'translate3d(0,'+translate+'px,-'+translate+'px) scaleY(' + scale + ')';

                                    }
                                },
                                onSetTransition: function(swiper, speed) {
                                    for (var i = 0; i < swiper.slides.length; i++){
                                      es = swiper.slides[i].style;
                                      es.webkitTransitionDuration = es.MsTransitionDuration = es.msTransitionDuration = es.MozTransitionDuration = es.OTransitionDuration = es.transitionDuration = speed + 'ms';

                                    }
                                 },
    })  
     </script>

     <div style="display:none">
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?c120670c814d08922e7048797e6472c1";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <!--baidu analysis-->
    <script>
        var _hmt = _hmt || [];
        
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?f41f07cad5c54cf66717306958dd62ed";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</div>
</body>
</html>
