<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>元旦快乐！—元宝铺</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
<link href="http://img0.zz91.com/front/favicon.ico" rel="shortcut icon">
<link rel="stylesheet" href="../subject/ybpnewyear/css/swiper.min.css">
<link rel="stylesheet" href="../subject/ybpnewyear/css/animate.min.css">
<link rel="stylesheet" href="../subject/ybpnewyear/css/newcss.css">
<link rel="stylesheet" href="../subject/ybpnewyear/css/index.css">
<script src="../subject/ybpnewyear/js/swiper.min.js"></script>
<script src="../subject/ybpnewyear/js/swiper.animate.min.js"></script>
<script src="http://img0.zz91.com/lib/jquery/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="http://m.zz91.com/zhongqiu/js/layer/layer.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<meta name="viewport" id="viewport" content="width=320, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
	#mcover{ position: fixed;top:0;left:0;width:100%;	height:100%;background:rgba(0, 0, 0, 0.7);	display:none;z-index:20000;}
	#mcover img {position: fixed;right: 18px;top:5px;width: 260px;height: 180px;z-index:20001;}
</style>
</head>
<body>
	<div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
		<img src="http://m.zz91.com/subject/ybpnewyear/images/img14.png">
	</div>
	<div id="mcover" onclick="$('#mcover').hide();">
		<img src="http://img0.zz91.com/zz91/mobile/images/guide.png" />
	</div>
<div class="swiper-container">
    <div class="swiper-wrapper">
        <section class="swiper-slide swiper-slide1">
            <div class="slide-main">
                <img src="../subject/ybpnewyear/images/bgimg.png" class="ani resize" swiper-animate-effect="imgplay1" style="height: 100%;width: 100%">
                
                <img src="../subject/ybpnewyear/images/img1.png" class="ani resize" swiper-animate-effect="imgplay2" style="width: 268px;top: 36px;left: 50%;margin-left: -134px;">

                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay3" style="width: 10px;top:29px;left: 60px;">

                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay4" style="width: 7px;top:54px;left: 57px;">

                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay5" style="width: 16px;top:46px;left:272px;">


                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay5" style="width: 10px;top:275px;left: 34px;">

                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay3" style="width: 7px;top:281px;left: 60px;">

                <img src="../subject/ybpnewyear/images/img2.png" class="ani resize" swiper-animate-effect="imgplay4" style="width: 22px;top:251px;left: 266px;">

                <img src="../subject/ybpnewyear/images/img4.png" class="ani resize" swiper-animate-effect="imgplay6" style="width: 144px;top:400px;left: 12px;">

                <img src="../subject/ybpnewyear/images/img5.png" class="ani resize" swiper-animate-effect="imgplay7" style="width: 285px;top:400px;left: 12px;">

                <img src="../subject/ybpnewyear/images/img3.png" class="ani resize" swiper-animate-effect="imgplay8" style="width: 110px;top:316px;left: 198px;">
            </div>
        </section>


        <section class="swiper-slide swiper-slide2">
            <div class="slide-main">
                <img src="../subject/ybpnewyear/images/bgimg.png" class="ani resize" swiper-animate-effect="imgplay1" style="height: 100%;width: 100%">

                <img src="../subject/ybpnewyear/images/img8.png" class="ani resize" swiper-animate-effect="imgplay9" style="width: 238px;top: 75px;left: 41px;height: 250px;">

                <img src="../subject/ybpnewyear/images/img6.png" class="ani resize" swiper-animate-effect="imgplay10" style="width: 56px;top: 0px;left: 8px;">

                <img src="../subject/ybpnewyear/images/img7.png" class="ani resize" swiper-animate-effect="imgplay11" style="width: 56px;top: 0px;left: 251px;">
                
                <img src="../subject/ybpnewyear/images/img9.png" class="ani resize" swiper-animate-effect="imgplay12" style="width: 111px;top: 89px;left: 104px;">

                <img src="../subject/ybpnewyear/images/img10.png" class="ani resize" swiper-animate-effect="imgplay13" style="width: 111px;top: 208px;left: 104px;">

                <img src="../subject/ybpnewyear/images/img11.png" class="ani resize" swiper-animate-effect="imgplay14" style="width: 119px;top: 330px;left: 101px;">
            </div>
        </section>

        <section class="swiper-slide swiper-slide3">
            <div class="slide-main">
                <img src="../subject/ybpnewyear/images/bgimg.png" class="ani resize" swiper-animate-effect="imgplay1" style="height: 100%;width: 100%">

                <img src="../subject/ybpnewyear/images/img8.png" class="ani resize" swiper-animate-effect="imgplay9" style="width: 238px;top: 75px;left: 41px;height: 250px;">

                <img src="../subject/ybpnewyear/images/img6.png" class="ani resize" swiper-animate-effect="imgplay10" style="width: 56px;top: 0px;left: 8px;">

                <img src="../subject/ybpnewyear/images/img7.png" class="ani resize" swiper-animate-effect="imgplay11" style="width: 56px;top: 0px;left: 251px;">
                
                <!-- <img src="../subject/ybpnewyear/images/img12.png" class="ani resize" swiper-animate-effect="imgplay12" style="width: 186px;top: 130px;left: 67px;">

                <img src="../subject/ybpnewyear/images/img13.png" class="ani resize" swiper-animate-effect="imgplay13" style="width: 186px;top: 220px;left: 67px;"> -->
                <button class="ani resize btnbox1 playrecord" swiper-animate-effect="imgplay12" style="width: 186px;height: 57px;top: 130px;left: 67px;">点此听好友的祝福</button>

                <button class="ani resize btnbox2 startrecord" swiper-animate-effect="imgplay13" style="width: 186px;height: 57px;top: 220px;left: 67px;">点此留下语音祝福</button>

                <img src="../subject/ybpnewyear/images/img15.png" class="ani resize" swiper-animate-effect="imgplay15" style="width: 32px;top: 367px;left: 42px;">

                <img src="../subject/ybpnewyear/images/img16.png" class="ani resize" swiper-animate-effect="imgplay16" style="width: 34px;top: 411px;left: 44px;">

                <img src="../subject/ybpnewyear/images/img17.png" class="ani resize" swiper-animate-effect="imgplay17" style="width: 49px;top: 355px;left: 228px;">

                <img src="../subject/ybpnewyear/images/img18.png" class="ani resize" swiper-animate-effect="imgplay18" style="width: 32px;top: 408px;left: 216px;">

                <img src="../subject/ybpnewyear/images/img19.png" class="ani resize" swiper-animate-effect="imgplay19" style="width: 139px;top: 315px;left: 82px;">
            </div>
        </section>
    </div>


    <img src="../subject/ybpnewyear/images/web-swipe-tip_95ef4d6.png" style="width:24px;height:18px; bottom:10px; left:50%;margin-left: -12px;" id="array" class="resize">


    <div class="swiper-pagination"></div>
    <div class="music-box music-play">
        <audio id="music-audio" class="audio" preload="" autoplay="autoplay" loop="">
            <source src="../subject/ybpnewyear/newyear.mp3"></source>
        </audio>
        <div class="music"></div>  
    </div>
</div>
<script>
    var oindex = 0;
	var nicheng = "";
	var serverId="";
	var recordflag=0;
	var localId="";
	function sharefunction() {
		wx.onMenuShareAppMessage({
			title: '元旦快乐！—元宝铺',
			desc: '不知不觉到元旦，匆匆而过又一年; 云卷云舒情如水，月落日出为赚钱；祝您：日子如蜜甜;汗水浇开财运花， 大步流星总向前',
			link: 'http://m.zz91.com/newyear/ybpindex.html?s={{signature}}',
			imgUrl: 'http://m.zz91.com/subject/ybpnewyear/images/img14.png',
			trigger: function(res) {
				
			},
			success: function(res) {
				layer.msg("分享成功。");
				$('#mcover').hide();
			},
			cancel: function(res) {
				//alert('已取消');
			},
			fail: function(res) {
				//alert(JSON.stringify(res));
			}
		});
		wx.onMenuShareTimeline({
			title: '元旦快乐！—元宝铺',
			desc: '不知不觉到元旦，匆匆而过又一年; 云卷云舒情如水，月落日出为赚钱；祝您：日子如蜜甜;汗水浇开财运花， 大步流星总向前',
			link: 'http://m.zz91.com/newyear/ybpindex.html?s={{signature}}',
			imgUrl: 'http://m.zz91.com/subject/ybpnewyear/images/img14.png',
			trigger: function(res) {
				//$('#mcover').show();
			},
			success: function(res) {
				layer.msg("分享成功。");
				$('#mcover').hide();
			},
			cancel: function(res) {
				//alert('已取消');
			},
			fail: function(res) {
				//alert(JSON.stringify(res));
			}
		});
	}
	var serverrecord="{{content}}";
	//alert(serverrecord)
	if (serverrecord=="None" || serverrecord==""){
		$(".playrecord").css("display","none");
	}else{
		$(".playrecord").css("display","block");
	}
	$(function(){
        wx.config({
			debug: false,
			appId: '{{appid}}',
			timestamp: {{timestamp}},
			nonceStr: '{{nonceStr}}',
			signature: '{{signature}}',
			jsApiList: [
				'checkJsApi',
				'onMenuShareTimeline',
				'onMenuShareAppMessage',
				'startRecord',
				'stopRecord',
				'onVoiceRecordEnd',
				'playVoice',
				'uploadVoice',
				'downloadVoice',
			]
		});
		sharefunction();
		
		function sharetofriend(){
			layer.msg('立即分享给您的亲人或朋友吧。', {
			  time: 0 //不自动关闭
			  ,btn: ['立即分享','取消']
			  ,yes: function(index){
			    layer.close(index);
			    $('#mcover').show();
				sharefunction();
			  }
			});
		}
		function savedata(content){
			var data={
				signature : '{{signature}}',
				content : content,
				sharename : '元宝铺',
			}
			
			sharefunction()
			$.ajax({
				url : 'http://m.zz91.com/zhongqiu/savecontent.html',
				type : 'post',
				dataType : 'json',
				cache : false,
				data : data,
			    success:function(ret) {
					if (ret) {
						//alert(ret)
					} else {
						//alert('异常！1')
					};
				},
				error : function(e) {
					//alert(alert(JSON.stringify(e)));
				}
			});
		}
		wx.ready(function(){
			
			
			$(".startrecord").on("click",function(){
				document.getElementById('music-audio').pause();
				if (recordflag==0){
					wx.startRecord();
					recordflag=1;
					$(".startrecord").html("正在录音...点击停止");
					wx.onVoiceRecordEnd({
					    // 录音时间超过一分钟没有停止的时候会执行 complete 回调
					    complete: function (res) {
					        localId = res.localId;
					        recordflag=0;
					        $(".startrecord").html("点击重新录音");
					        $(".playrecord").show();
					        $(".playrecord").css("display","block");
					        $(".playrecord").html("听听我的录音!");
					        wx.uploadVoice({
							    localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
							    isShowProgressTips: 1, // 默认为1，显示进度提示
						        success: function (res) {
							        serverId = res.serverId; // 返回音频的服务器端ID
							        savedata(serverId);
							        sharetofriend();
							    }
							});
					        
					    }
					});
				}else{
					wx.stopRecord({
					    success: function (res) {
					        localId = res.localId;
					        recordflag=0;
					        $(".startrecord").html("点击重新录音");
					        $(".playrecord").show();
					        $(".playrecord").css("display","block");
					        $(".playrecord").html("听听我的录音!");
					        wx.uploadVoice({
							    localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
							    isShowProgressTips: 1, // 默认为1，显示进度提示
						        success: function (res) {
							        serverId = res.serverId; // 返回音频的服务器端ID
							        savedata(serverId);
							        sharetofriend();
							    }
							});
					    }
					});
					recordflag=0
				}
		    })
			$(".playrecord").on("click",function(){
				var self=$(this);
				if (localId==""){
					//alert('没有录音文件!');
					wx.downloadVoice({
					    serverId: '{{content}}', // 需要下载的音频的服务器端ID，由uploadVoice接口获得
					    isShowProgressTips: 1, // 默认为1，显示进度提示
					    success: function (res) {
					        localId = res.localId; // 返回音频的本地ID
					        //alert(localId)
					        wx.playVoice({
							    localId: localId // 需要播放的音频的本地ID，由stopRecord接口获得
							});
							$(".playrecord").html("正在播放录音...")
					    }
					});
				}else{
					wx.playVoice({
					    localId: localId // 需要播放的音频的本地ID，由stopRecord接口获得
					});
					$(".playrecord").html("正在播放录音...")
				}
				wx.onVoicePlayEnd({
				    success: function (res) {
				        localId = res.localId; // 返回音频的本地ID
				        $(".playrecord").html("点此重听");
				    }
				});
		    })
			$(".fenxian").on("click", function() {
				if(ua.match(/MicroMessenger/i)=="micromessenger") {
					$('#mcover').show();
					sharefunction();
				}
			})
			sharefunction();
	    })
		
	})


    $(".music-box").on("click",function(){
        if($(this).hasClass('rotate')){
             document.getElementById('music-audio').pause();
        }else{
            document.getElementById('music-audio').play();
        }
        $(this).toggleClass("rotate");
    })
    var pageScale = 1;

    var width = document.documentElement.clientWidth || 320;
    var height = document.documentElement.clientHeight || 480;
    if (width / height >= 320 / 480) {
        pageScale = height / 480;
    } else {
        pageScale = width / 320;
    }
    var content = 'width=320, initial-scale=' + pageScale + ', maximum-scale=' + pageScale + ', user-scalable=no';
    document.getElementById('viewport').setAttribute('content', content); 
	document.getElementById('music-audio').play();
	$(".music-box").toggleClass("rotate");

    scaleW=window.innerWidth/320;
    scaleH=window.innerHeight/480;
    var resizes = document.querySelectorAll('.resize');
        for (var j=0; j<resizes.length; j++) {
        }
          
    var mySwiper = new Swiper ('.swiper-container', 
                                {   
                                    initialSlide:0,
                                    direction : 'vertical',
                                    pagination: '.swiper-pagination',
                                    //virtualTranslate : true,
                                    mousewheelControl : true,
                                    onInit: function(swiper){
                                    swiperAnimateCache(swiper);
                                    swiperAnimate(swiper);
                                },
                                onSlideChangeEnd: function(swiper){
                                    swiperAnimate(swiper);
                                },
                                onTransitionEnd: function(swiper){
                                    swiperAnimate(swiper);
                                },
                                watchSlidesProgress: true,
                                onProgress: function(swiper){
                                    for (var i = 0; i < swiper.slides.length; i++){
                                        var slide = swiper.slides[i];
                                        var progress = slide.progress;
                                        var translate = progress*swiper.height/4;  
                                        scale = 1 - Math.min(Math.abs(progress * 0.5), 1);
                                        var opacity = 1 - Math.min(Math.abs(progress/2),0.5);
                                        slide.style.opacity = opacity;
                                        es = slide.style;
                                        es.webkitTransform = es.MsTransform = es.msTransform = es.MozTransform = es.OTransform = es.transform = 'translate3d(0,'+translate+'px,-'+translate+'px) scaleY(' + scale + ')';

                                    }
                                },
                                onSetTransition: function(swiper, speed) {
                                    for (var i = 0; i < swiper.slides.length; i++){
                                      es = swiper.slides[i].style;
                                      es.webkitTransitionDuration = es.MsTransitionDuration = es.msTransitionDuration = es.MozTransitionDuration = es.OTransitionDuration = es.transitionDuration = speed + 'ms';

                                    }
                                 },
    })  
     </script>

     <div style="display:none">
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?c120670c814d08922e7048797e6472c1";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    <!--baidu analysis-->
    <script>
        var _hmt = _hmt || [];
        
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?f41f07cad5c54cf66717306958dd62ed";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</div>
</body>
</html>
