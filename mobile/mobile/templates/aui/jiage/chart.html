<!doctype html>
<html>
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
		<meta content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="address=no" name="format-detection" />
		<meta name="apple-mobile-web-app-capable" content="no" />
		<link rel="apple-touch-icon-precomposed" href="http://img0.zz91.com/zz91/images/logo.png" />
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-precomposed" />
		<meta name="apple-touch-fullscreen" content="YES">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="shortcut icon" href="http://img0.zz91.com/front/favicon.ico" />
		<title>趋势图-{{webtitle}}-ZZ91再生网手机站</title>
		<link rel="stylesheet" type="text/css" href="http://static.m.zz91.com/aui/css/aui.2.0.css"/>
		<link rel="stylesheet" type="text/css" href="http://static.m.zz91.com/aui/css/aui.css"/>
		<link rel="stylesheet" type="text/css" href="http://static.m.zz91.com/aui/css/common.css"/>
		<script type="text/javascript" src="http://static.m.zz91.com/aui/js/jquery.js"></script>
		<script type="text/javascript" src="http://static.m.zz91.com/aui/js/comm.js" ></script>
		<script src="http://img0.zz91.com/lib/jquery/jquery.canvasjs.min.js"></script>
		<style>
			.clearfix:after{content:".";display:block;height:0;clear:both;visibility:hidden}
			.clearfix{height:1%}
			.clearfix{display:block}
			.aui-bar{
				position: fixed;
				z-index: 999;
				top: 0px;
			}
			#chart_container {
				display: inline-block;
				font-family: Arial, Helvetica, sans-serif;
				position:relative;
				margin-top:50px;
			}
			#chart {
			  position: relative;
			  left: 40px;
			  width: 540px;
			  height: 300px;
			}
			
			#y_axis {
			  position: absolute;
			  top: 0;
			  bottom: 0;
			  width: 40px;
			}
			#x_axis {
				position: absolute;
				left: 40px;
				height: 40px;
				bottom:20px;
			}
			#preview{
				position: absolute;
				left: 40px;
				bottom:0px;
			}
			.hq-viewinfo{
				height: 450px;
			}
			.pricetitle{
				width: 100%;
				text-align: center;
				font-size: 18px;
				font-weight: bold;
				line-height: 30px;
				margin-bottom: 30px;
			}
			.hq-view-other p{
				float: left;
				margin: 10px;
			}
			.searchlabel{
				margin-left: 50px;
			}
			.searchlabel span{
				display: inline-block;
				width: 30px;
				height: 30px;
				line-height: 30px;
				text-align: center;
				cursor: pointer;
				color: #000;
				background: #ebebeb;
				vertical-align: middle;
				margin-left: 15px;
			}
			.searchlabel .on{
				background: #54b854;
				color: #fff;
			}
			.hq-list-ul li{
				width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
			}
			.footer{
				width:1200px;
			}
			#topBarInfo{
				width:1200px;
			}

		</style>
	</head>
	<body>
		<header class="aui-bar aui-bar-nav aui-bar-primary">
	    	<a class="aui-pull-left" href="javascript:history.back(-1)">
		        <span class="aui-iconfont aui-icon-left"></span>
		    </a>
		    <div class="aui-title">产品价格趋势图</div>
		</header>
		<div style="height:45px"></div>
		<aside class="download-bar J_fixBar" id="J_appJump" style="top:45px;height: 55px;left: 0px;">
			<div class="download">
				<div class="intro" style="padding-top: 5px;;">
					<div class="logo"></div>
					<ul>
						<li class="logo-title">使用ZZ91客户端</li>
						<li style="font-size: 12px;">获更多优质资源，送<b style="color: #FFFF00;">20</b>元红包</li>
					</ul>
				</div>
				<div class="download-btn"> <a class="J_app" href="http://m.zz91.com/app.html">免费下载</a> </div>
			</div>
		</aside>
		<div style="height:55px"></div>
		<div class="aui-content">
			<h2 class="aui-text-center aui-margin-t-15">{{label}}趋势图</h2>
			<div class="fr hq-viewinfo">
                <div class="hq-view-title clearfix">
                    <div class="fl hq-view-name"></div>
                    <div class="fl hq-view-other">
                        <p>最高：<span class="maxprice"></span></p>
                        <p>最低：<span class="minprice"></span></p>
                        <p>均值：<span class="midprice"></span></p>
                    </div>
                    <input id="pid" value="{{id}}" type="hidden">
                </div>
                <div style="clear: both;"></div>

                <div class="hq-view-box">
                    <div class="hq-view-tjian">
                        <span class="searchlabel">
	                        <span>周</span>
	                        <span>月</span>
	                        <span>季</span>
	                        <span>年</span>
                        </span>
                    </div>
					<div id="chartContainer">
						
					</div>
                </div>
            </div>
			
			<div style="width: 100%;text-align: center;line-height: 30px;clear: both;">我要订阅该行情<br>长按识别二维码，关注 “zz91再生网”<br /><img src="http://img0.zz91.com/zz91/weixin/images/priceorder.png"><br /></div>
            <div style="text-align: center;font-weight: bold;color: #ff0000;margin-bottom: 20px; border: solid 1px #006600;background-color: #fff; padding: 10px;"><a href="http://m.zz91.com/register/" style="color: #ff0000;">点此留下您的联系方式，查看更多相关行情报价</a></div>
            
		</div>
	</body>
	
	<script type="text/javascript">
		var infoid={{id}};
		$(".zz91share").on("click", function() {
			layer.open({
			  type: 2,
			  title: false,
			  closeBtn: 0, //不显示关闭按钮
			  shadeClose: true,
			  shade: 0.4,
			  anim: 2,
			  area: ['90%', '170px'],
			  content: '/myrc/share.html?p' //iframe的url
			}); 
		})
		
		$(".category-table-box tr:odd td").css("background","#f2f2f2");
		var oneDay = 1000 * 60 * 60 * 24;
		function getdiffdate(num){
		   var myDate = new Date();//当前时间
		   var lastDate = new Date(myDate - oneDay * num);
		   var lastYear = lastDate.getFullYear();
		   var lastMonth = lastDate.getMonth() + 1;
		   var lastDay = lastDate.getDate();
		   return lastYear+"-"+lastMonth+"-"+lastDay
		}
		function getnowDate(){ 
			var myDate = new Date();//当前时间
			var year = myDate.getFullYear();//当前年份
			var month = myDate.getMonth() + 1;//当前月份
			var day = myDate.getDate();//当前日
			return year+"-"+month+"-"+day
		} 
		function transdate(endTime){ 
			var date=new Date(); 
			date.setFullYear(endTime.substring(0,4)); 
			date.setMonth(endTime.substring(5,7)-1); 
			date.setDate(endTime.substring(8,10)); 
			date.setHours(endTime.substring(11,13)); 
			date.setMinutes(endTime.substring(14,16)); 
			date.setSeconds(endTime.substring(17,19)); 
			return Date.parse(date)/1000; 
		} 
		function ajaxinfo(){
			//年 季 月 周
	        $(".searchlabel span").bind("click",function(){
	            $(".searchlabel span").removeClass("on");
	            $(this).addClass("on");
	            var todate=getnowDate();
	            if ($(this).text()=="周"){
	            	var fromdate=getdiffdate(7)
	            }
	            if ($(this).text()=="月"){
	            	var fromdate=getdiffdate(30)
	            }
	            if ($(this).text()=="季"){
	            	var fromdate=getdiffdate(90)
	            }
	            if ($(this).text()=="年"){
	            	var fromdate=getdiffdate(365)
	            }
	            saveorder($("#pid").val(),fromdate,todate)
	        });
	        
		}
		function saveorder(id,gmt_begin,gmt_end){
			var data={
				id:id
			}
			if (gmt_begin){
				data['gmt_begin']=gmt_begin;
			}
			if (gmt_end){
				data['gmt_end']=gmt_end;
			}
			$.ajax({
				url : '/jiage/pricechartdata.html?'+ (new Date()).getTime().toString(),
				type : 'get',
				dataType : 'json',
				cache : false,
				data : data,
			    success:function(ret) {
			    	var gdata=[]
					if (ret) {
						var maxprice=0;
						var minprice=0;
						i=0;
						//alert(JSON.stringify(gdata))
						$.each(ret, function(i, item) {
							var l={x:new Date(item.posttime*1000),y:item.aveprice};
							if (item.aveprice>maxprice){
								maxprice=item.aveprice;
							}
							gdata.push(l);
							if (i==0){
								minprice=item.aveprice;
							}
							if (minprice>item.aveprice){
								minprice=item.aveprice
							}
						})
						$(".maxprice").html(maxprice);
						$(".minprice").html(minprice);
						$(".midprice").html((maxprice+minprice)/2);
						showgraph(id,gdata,maxprice,minprice);
						//选中
						//trselecton(id);
					} else {
						
					};
				},
				error : function() {
					alert("异常！");
				}
			});
		}
		
		function showgraph(id,data,maxprice,minprice){
			var chart = new CanvasJS.Chart("chartContainer", {
				width:$("body").width(),
				height:370,
				animationEnabled: true,
				title: {
					text: "{{label}}",
					fontSize: 25
				},
				animationEnabled: true,
				axisX: {
					gridColor: "Silver",
					tickColor: "silver",
					valueFormatString: "YYYY-MM-DD"
				},
				toolTip: {
					shared: true
				},
				axisY: {
					title: "",
					includeZero: false,
					minimum: minprice-minprice*0.1,
					maximum: maxprice*1.1,
					fontSize: 12
				},
				legend: {
					verticalAlign: "center",
					horizontalAlign: "right"
				},
				data: [
				{
					type: "spline",
					//showInLegend: true,
					xValueFormatString:"时间：YYYY-MM-DD",
					yValueFormatString:"￥#######.00",
					lineThickness: 1,
					name: "价格",
					//markerType: "square",
					color: "#F08080",
					dataPoints: data
				}
				],
				legend: {
					cursor: "pointer",
					itemclick: function (e) {
						if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
							e.dataSeries.visible = false;
						}
						else {
							e.dataSeries.visible = true;
						}
						chart.render();
					}
				}
			});
		
			chart.render();
		
		}
		$(function(){
			
			ajaxinfo();
			saveorder(infoid,'','')
		})

	</script>
	{%include 'aui/bottom.html'%}
	<script type="text/javascript"> 
	     /*kangxianyue 创建于2016-12-14*/ 
	     var cpro_id = "u2845509";
	</script>
	<script src="http://cpro.baidustatic.com/cpro/ui/cm.js" type="text/javascript"></script>
</html>