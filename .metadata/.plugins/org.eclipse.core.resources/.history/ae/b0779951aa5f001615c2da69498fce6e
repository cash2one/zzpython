<!doctype html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>Hello APP</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
		<style>
			/* 头部样式 */
			#wrap{
				background: #01ba2e;
				height: auto;
			}
			.topbar {
				background: #01ba2e;
				height: 50px;
				border-bottom: 1px solid #DDDFE3;
			}
			.topbar_title {
				display: inline-block;
				font-size: 20px;
				line-height: 50px;
				padding-left: 12px;
			}
			.hr01, .hr02 {
				height: 28px;
			}
			.headerico {
				padding: 11px 15px 11px 15px;
			}
			.headericohover {
				background: #DADDE0;
			}
			.fr {
				float: right;
			}
			.fl {
				float: left;
			}
			/*第一头部*/
			#logo {
				padding: 11px 0 0 10px;
				height: 28px;
			}
			#citylist {
				height: 50px;
				line-height: 50px;
				padding-left: 15px;
				font-size: 18px;
				color: #fff;
			}
			.citylistarrow {
				vertical-align: top;
				width: 20px;
				padding-top: 15px;
			}
			.search {
				height: 34px;
				line-height: 34px;
				padding-left: 10px;
				border-radius: 30px;
				margin-top: 8px;
				position: absolute;
				left: 20px;
				right: 60px;
				font-size: 14px;
			}
			.search img:first-child {
				vertical-align: top;
				width: 20px;
				padding-top: 12px;
				padding-right: 10px;
			}
			.search img:last-child {
				vertical-align: top;
				width: 27px;
				padding-top: 4px;
			}
			.firstSearch {
				left: 90px;
				right: 60px;
				background-color: #FA6604;
				color: #FDC29B;
			}
			/* 第二头部 */
			#topbar_refresh {
				width: 40px;
				padding: 5px 10px;
			}
			.whitebar {
				background-color: #01ba2e;
			}
			#whitecity {
				height: 50px;
				line-height: 50px;
				padding-left: 15px;
				font-size: 18px;
				color: #FF8400;
			}
			.secCitylistarrow {
				vertical-align: top;
				width: 15px;
				padding-top: 18px;
				padding-left: 5px;
			}
			.secSearch {
				left: 90px;
				right: 15px;
				background-color: #E8E8E8;
				color: #999;
			}
			/* 第三头部 */
			.swipepic {
				padding: 5px 15px 2px 15px;
				height: 23px;
			}
			.swipe div {
				font-size: 4px;
				text-align: center;
				color: #fff;
			}
			.thrSearch {
				left: 50px;
				right: 60px;
				background-color: #E8E8E8;
				color: #999;
			}
			/* 头部切换样式 */
			.activebar {
				display: block;
			}
			/* 底部切换按钮样式 */
			ul {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
			}
			#footer {
				height: 61px;
				line-height: 60px;
				background-color: #FAFAFA;
				border-top: 1px solid #FAFAFA;
			}
			#footer li {
				-webkit-box-flex: 1;
				-webkit-flex: 1;
				flex: 1;
				height: 60px;
			}
			/* 选项卡样式 */
			.scrollbar {
				display: -webkit-box;
				display: -webkit-flex;
				text-align: center;
				height: 40px;
				line-height: 40px;
				background: #EBECF0;
				font-size: 12px;
				position: relative;
			}
			.col1 {
				-webkit-box-flex: 1;
				-webkit-flex: 1;
				flex: 1;
				color: #909090;
			}
			.indexbar {
				position: absolute;/*background: #0fc;*/
				width: 50%;
				height: 5px;
				left: 0px;
				bottom: 0px;
				-webkit-transition: 300ms;
			}
			.redbox {
				background: #DB4646;
				width: 40px;
				height: 5px;
				position: relative;
				left: auto;
				right: auto;
				margin-left: auto;
				margin-right: auto;
			}
			/* 本地刷新图标 */
			#localrefresh {
				display: none;
				float: right;
				width: 40px;
				padding: 5px 10px;
			}
			#field1::-webkit-input-placeholder {
				color: #666;
			}
			#field1 {
				height: 18px;
				line-height: 18px;
				width: 70%;
			}
			.thridHeader .search input::-webkit-input-placeholder {
				line-height: 30px;
			}
			.thridHeader .search input {
				line-height: 30px;
			}
			.swipe {
				line-height: 50px;
				margin-right: 10px;
				color: #fff;
			}
			.back {
				float: left;
				width: 20px;
				margin-top: 4px
			}
			.back img {
				height: 30px;
				margin-top: 10px;
				margin-left: 10px;
			}
		</style>
	</head>
	<body>
		<div id="wrap">
			<!-- 第三头部 -->
			<div id="thridHeader" class="titlebar">
				<div class="topbar whitebar">
					<div class="back"  tapmode="" onclick="goback()"><img src="../../image/jiantou.png" alt="" style="height:20px">
					</div>
					<div class="search thrSearch">
						<input type="text" class="" id="keywords" placeholder="请输入搜索内容">
						<!--<img src="../../image/icon_mic_normal.png" alt="" tapmode="" onclick="voiceSearch()">-->
					</div>
					<div class="swipe fr" id="searchbutton">
						搜索
					</div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/zepto.min.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/laytpl.js"></script>
	<script type="text/javascript">
		function goback() {
			api.closeWin({
				name : 'search'
			});
		}

		// 完成首页初始化
		apiready = function() {
			var thridHeader = $api.byId('thridHeader');
			var header = $api.byId('wrap');
			//$api.fixStatusBar(header);
			
			var thridHeader = $api.offset(header);
			var type = api.pageParam.type;
			
			api.openFrame({
				name : 'search_body',
				url : './search_body.html',
				rect : {
					x : 0,
					y : thridHeader.h,
					w : 'auto',
					h : 'auto'
				},
				pageParam : api.pageParam,
				bounces : false,
				delay : 200
			});
			//document.getElementById("keywords").focus();
			$("#searchbutton").on("click", function() {
				//供求搜索
				//zzalert(JSON.stringify(api.pageParam))
				//供求搜索
				if (!type) {
					var keywords = $("#keywords").val()
					var pageParam = {
						type : "trade-list",
						label_hex : keywords,
						label : keywords
					};
					type== "trade-list";
					openWin("trade-list", "../trade/trade-list.html", pageParam);
					return;
				}else{
					if (type== "trade-list") {
						api.execScript({
							name : 'trade-list',
							frameName : 'trade-list_',
							script : "keywordssearch('" + $("#keywords").val() + "')"
						});
					}
				}
				//行情报价搜索
				if (type== "offer-list") {
					var keywords = $("#keywords").val()
					var pageParam = {
						type : "offer-list",
						keywords : keywords
					};
					openWin("offer-list", "../price/price.html", pageParam);
					api.execScript({
						name : 'offer-list',
						frameName : 'offer-list_',
						script : "searchprice('" + $("#keywords").val() + "')"
					});
					//隐藏左边筛选按钮
					//api.execScript({
						//name : 'offer-list',
						//script : "hidrightbutton()"
					//});
				}
				//行情报价搜索
				if (type== "company-list") {
					var keywords = $("#keywords").val()
					var pageParam = {
						type : "company-list",
						keywords : keywords
					};
					api.execScript({
						name : 'company-list',
						frameName : 'company-list_',
						script : "searchkeywords('" + $("#keywords").val() + "')"
					});
				}
				//厂家直购搜索
				if (type== "vender") {
					var keywords = $("#keywords").val();
					//alert(keywords)
					var pageParam = {
						type : "vender",
						keywords : keywords,
						showbottom : 1
					};
					openWin("vender", "../zhigou/vender.html", pageParam);
					api.execScript({
						name : 'vender',
						frameName : 'vender_',
						script : "searchkeywords('" + $("#keywords").val() + "')"
					});
				}
				//互助社区搜索
				//zzalert(type)
				if (type== "community" || type=='huzhu-list') {
					var keywords = $("#keywords").val()
					var pageParam = {
						type : "huzhu-list",
						keywords : keywords
					};
					openWin("huzhu-list", "../huzhu/hudong-list.html", pageParam);
					api.execScript({
						name : 'huzhu-list',
						frameName : 'huzhu-list_',
						script : "keywordssearch('" + $("#keywords").val() + "')"
					});
				}
				
				//localStorage.removeItem('seartext');
				//保存搜索历史纪录
				var seartext = localStorage.getItem("seartext");
				if (!seartext) {
					seartext = "";
				}
				if ($("#keywords").val() != "") {
					if (seartext!=""){
						$.each(seartext, function(index, item) {
							if (item.type == type) {
								if (item.value!=$("#keywords").val()){
									var seartexta = "{'type' : '" + type + "','value' : '" + $("#keywords").val() + "'}";
									seartext = seartext + seartexta + ",";
									localStorage.setItem("seartext", seartext)
								}
							}
						});
					}else{
						var seartexta = "{'type' : '" + type + "','value' : '" + $("#keywords").val() + "'}";
						seartext = seartext + seartexta + ",";
						localStorage.setItem("seartext", seartext)
					}
				}
				api.closeWin({
					name : 'search'
				});
			})
		};
		/**
		 * json对象转字符串形式
		 */
		function json2str(o) {
			var arr = [];
			var fmt = function(s) {
				if ( typeof s == 'object' && s != null)
					return json2str(s);
				return /^(string|number)$/.test( typeof s) ? "'" + s + "'" : s;
			}
			for (var i in o)
			arr.push("'" + i + "':" + fmt(o[i]));
			return '{' + arr.join(',') + '}';
		}

		function voiceSearch() {
			var obj = api.require('speechRecognizer');
			api.toast({
				msg : "语音识别开始，请说话",
				duration : 1000,
				location : "middle"
			});
			obj.record({
			}, function(ret, err) {
				if (ret.status) {
					// ret.wordStr;
					api.alert({
						title : "识别结果",
						msg : ret.wordStr
					})
					obj.stopRecord();
				}
			});
		}
	</script>
	<script type="text/javascript" src="../../script/servercomm.js"></script>
</html>